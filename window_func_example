--клдичество по входящих в группу +-5 от зарплаты
select id, name, salary, 
count(*) over(order by salary desc
			 range between 5 preceding and 5 following)
						
from employees
order by  salary, id



--найти макисмальное из ближайшего значения
select id, name, salary, 
max(salary) over(order by salary desc
			 rows between 1 preceding and 1 following)
						
from employees
order by  salary, id





--обратная сортировка данных
select id, name, department,salary, 
count(*) over(order by salary desc
			 rows between unbounded preceding and current row)						
from employees
order by  salary, id


--rows between unboundend precending and currentw row


--скользящее
select year, month, income , 
avg(income) over (order by month
				 rows between 1 preceding  and 0 following) as qwe
from expenses



--нарастающий итог
select id, name, department, salary,
sum(salary) over(partition by department 
				rows between unbounded  preceding  and 0 following)
				--rows between unbounded  preceding  and current row)
from employees



--явно задать границы фрейма
select  name, department, salary, round((salary*100.0/high))
from(
	select  name, department,   salary,
	last_value(salary) over w as high
	from employees
	window w as (
		partition by department 
		order by salary
		rows  between  unbounded preceding and unbounded following)
	order by city, salary asc
) 	t



-- dense_rank-- нумерует без пропуска.
select dense_rank() over(order by sum_n_messages desc )
,  id_guest
, sum_n_messages 
from (
  select  id_guest, 
  sum(n_messages) sum_n_messages 
  from airbnb_contacts 
  group by 1 
  order by 2 desc
) t;
